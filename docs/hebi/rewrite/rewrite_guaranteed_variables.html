<!doctype html>
<html lang="en">
<head>
<style>.homelink{display:block;font-size:2em;font-weight:bold;color:#555;padding-bottom:.5em;border-bottom:1px solid silver}.homelink:hover{color:inherit}.homelink img{max-width:20%;max-height:5em;margin:auto;margin-bottom:.3em}</style>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<link rel="icon" href="https://raw.githubusercontent.com/OpShin/hebi/dev/docs/hebi_32.png" sizes="32x32" type="image/png">
<title>hebi.rewrite.rewrite_guaranteed_variables API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}#lunr-search{width:100%;font-size:1em;padding:6px 9px 5px 9px;border:1px solid silver}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<style>
.github-corner:hover .octo-arm {
animation: octocat-wave 560ms ease-in-out
}
@keyframes octocat-wave {
0%,
100% {
transform: rotate(0)
}
20%,
60% {
transform: rotate(-25deg)
}
40%,
80% {
transform: rotate(10deg)
}
}
@media (max-width:500px) {
.github-corner:hover .octo-arm {
animation: none
}
.github-corner .octo-arm {
animation: octocat-wave 560ms ease-in-out
}
}
</style>
<a href="https://github.com/opshin/hebi" class="github-corner" aria-label="View source on GitHub">
<svg width="80" height="80" viewBox="0 0 250 250"
style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
<path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z">
</path>
<path
d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
<path
d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
fill="currentColor" class="octo-body"></path>
</svg>
</a>
<article id="content">
<header>
<h1 class="title">Module <code>hebi.rewrite.rewrite_guaranteed_variables</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from ast import *
from copy import copy
from collections import defaultdict

from ..util import CompilingNodeVisitor, CompilingNodeTransformer
from ..type_inference import INITIAL_SCOPE

&#34;&#34;&#34;
Checks that used variables are bound in every branch of preceding control flow
&#34;&#34;&#34;


class RewriteGuaranteedVariables(CompilingNodeTransformer):
    step = &#34;Ensure variables are bound&#34;

    loaded_vars = None
    # names that are guaranteed to be available to the current node
    # this acts differently to the type inferencer! in particular, ite/while/for all produce their own scope
    guaranteed_avail_names = [
        list(INITIAL_SCOPE.keys()) + [&#34;List&#34;, &#34;Dict&#34;, &#34;Union&#34;, &#34;isinstance&#34;]
    ]

    def guaranteed(self, name: str) -&gt; bool:
        name = name
        for scope in reversed(self.guaranteed_avail_names):
            if name in scope:
                return True
        return False

    def enter_scope(self):
        self.guaranteed_avail_names.append([])

    def exit_scope(self):
        self.guaranteed_avail_names.pop()

    def set_guaranteed(self, name: str):
        self.guaranteed_avail_names[-1].append(name)

    def visit_Module(self, node: Module) -&gt; Module:
        # repeat until no more change due to removal
        # i.e. b = a; c = b needs 2 passes to remove c and b
        node_cp = copy(node)
        self.enter_scope()
        node_cp.body = [self.visit(s) for s in node_cp.body]
        self.exit_scope()
        return node_cp

    def visit_If(self, node: If):
        node_cp = copy(node)
        node_cp.test = self.visit(node.test)
        self.enter_scope()
        node_cp.body = [self.visit(s) for s in node.body]
        scope_body_cp = self.guaranteed_avail_names[-1].copy()
        self.exit_scope()
        self.enter_scope()
        node_cp.orelse = [self.visit(s) for s in node.orelse]
        scope_orelse_cp = self.guaranteed_avail_names[-1].copy()
        self.exit_scope()
        # what remains after this in the scope is the intersection of both
        for var in set(scope_body_cp).intersection(scope_orelse_cp):
            self.set_guaranteed(var)
        return node_cp

    def visit_While(self, node: While):
        node_cp = copy(node)
        node_cp.test = self.visit(node.test)
        self.enter_scope()
        node_cp.body = [self.visit(s) for s in node.body]
        node_cp.orelse = [self.visit(s) for s in node.orelse]
        self.exit_scope()
        return node_cp

    def visit_For(self, node: For):
        node_cp = copy(node)
        assert isinstance(node.target, Name), &#34;Can only assign to singleton name&#34;
        self.enter_scope()
        self.guaranteed(node.target.id)
        node_cp.body = [self.visit(s) for s in node.body]
        node_cp.orelse = [self.visit(s) for s in node.orelse]
        self.exit_scope()
        return node_cp

    def visit_ListComp(self, node: ListComp):
        assert len(node.generators) == 1, &#34;Currently only one generator supported&#34;
        gen = node.generators[0]
        assert isinstance(
            gen.target, Name
        ), &#34;Can only assign value to singleton element&#34;
        assert isinstance(gen.target, Name), &#34;Can only assign to singleton name&#34;
        node_cp = copy(node)
        node_cp.generators = [copy(gen)]
        self.enter_scope()
        self.set_guaranteed(gen.target.id)
        node_cp.generators[0].ifs = [self.visit(if_expr) for if_expr in gen.ifs]
        node_cp.elt = self.visit(node.elt)
        self.exit_scope()
        return node_cp

    def visit_Assign(self, node: Assign):
        for t in node.targets:
            assert isinstance(t, Name), f&#34;Need to have name, not {t.__class__}&#34;
            self.set_guaranteed(t.id)
        return self.generic_visit(node)

    def visit_AnnAssign(self, node: AnnAssign):
        assert isinstance(
            node.target, Name
        ), f&#34;Need to have name, not {node.target.__class__}&#34;
        self.set_guaranteed(node.target.id)
        return self.generic_visit(node)

    def visit_ClassDef(self, node: ClassDef):
        self.set_guaranteed(node.name)
        return node

    def visit_FunctionDef(self, node: FunctionDef):
        node_cp = copy(node)
        self.set_guaranteed(node.name)
        self.enter_scope()
        # variable names are available here
        for a in node.args.args:
            self.set_guaranteed(a.arg)
        node_cp.body = [self.visit(s) for s in node.body]
        self.exit_scope()
        return node_cp

    def visit_Name(self, node: Name):
        if isinstance(node.ctx, Load):
            assert self.guaranteed(
                node.id
            ), f&#34;Variable {node.id} is not initialized in (every branch of) preceding control flow&#34;
        return self.generic_visit(node)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables"><code class="flex name class">
<span>class <span class="ident">RewriteGuaranteedVariables</span></span>
</code></dt>
<dd>
<div class="desc"><p>A :class:<code>NodeVisitor</code> subclass that walks the abstract syntax tree and
allows modification of nodes.</p>
<p>The <code>NodeTransformer</code> will walk the AST and use the return value of the
visitor methods to replace or remove the old node.
If the return value of
the visitor method is <code>None</code>, the node will be removed from its location,
otherwise it is replaced with the return value.
The return value may be the
original node in which case no replacement takes place.</p>
<p>Here is an example transformer that rewrites all occurrences of name lookups
(<code>foo</code>) to <code>data['foo']</code>::</p>
<p>class RewriteName(NodeTransformer):</p>
<pre><code>   def visit_Name(self, node):
       return Subscript(
           value=Name(id='data', ctx=Load()),
           slice=Index(value=Str(s=node.id)),
           ctx=node.ctx
       )
</code></pre>
<p>Keep in mind that if the node you're operating on has child nodes you must
either transform the child nodes yourself or call the :meth:<code>generic_visit</code>
method for the node first.</p>
<p>For nodes that were part of a collection of statements (that applies to all
statement nodes), the visitor may also return a list of nodes rather than
just a single node.</p>
<p>Usually you use the transformer like this::</p>
<p>node = YourTransformer().visit(node)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class RewriteGuaranteedVariables(CompilingNodeTransformer):
    step = &#34;Ensure variables are bound&#34;

    loaded_vars = None
    # names that are guaranteed to be available to the current node
    # this acts differently to the type inferencer! in particular, ite/while/for all produce their own scope
    guaranteed_avail_names = [
        list(INITIAL_SCOPE.keys()) + [&#34;List&#34;, &#34;Dict&#34;, &#34;Union&#34;, &#34;isinstance&#34;]
    ]

    def guaranteed(self, name: str) -&gt; bool:
        name = name
        for scope in reversed(self.guaranteed_avail_names):
            if name in scope:
                return True
        return False

    def enter_scope(self):
        self.guaranteed_avail_names.append([])

    def exit_scope(self):
        self.guaranteed_avail_names.pop()

    def set_guaranteed(self, name: str):
        self.guaranteed_avail_names[-1].append(name)

    def visit_Module(self, node: Module) -&gt; Module:
        # repeat until no more change due to removal
        # i.e. b = a; c = b needs 2 passes to remove c and b
        node_cp = copy(node)
        self.enter_scope()
        node_cp.body = [self.visit(s) for s in node_cp.body]
        self.exit_scope()
        return node_cp

    def visit_If(self, node: If):
        node_cp = copy(node)
        node_cp.test = self.visit(node.test)
        self.enter_scope()
        node_cp.body = [self.visit(s) for s in node.body]
        scope_body_cp = self.guaranteed_avail_names[-1].copy()
        self.exit_scope()
        self.enter_scope()
        node_cp.orelse = [self.visit(s) for s in node.orelse]
        scope_orelse_cp = self.guaranteed_avail_names[-1].copy()
        self.exit_scope()
        # what remains after this in the scope is the intersection of both
        for var in set(scope_body_cp).intersection(scope_orelse_cp):
            self.set_guaranteed(var)
        return node_cp

    def visit_While(self, node: While):
        node_cp = copy(node)
        node_cp.test = self.visit(node.test)
        self.enter_scope()
        node_cp.body = [self.visit(s) for s in node.body]
        node_cp.orelse = [self.visit(s) for s in node.orelse]
        self.exit_scope()
        return node_cp

    def visit_For(self, node: For):
        node_cp = copy(node)
        assert isinstance(node.target, Name), &#34;Can only assign to singleton name&#34;
        self.enter_scope()
        self.guaranteed(node.target.id)
        node_cp.body = [self.visit(s) for s in node.body]
        node_cp.orelse = [self.visit(s) for s in node.orelse]
        self.exit_scope()
        return node_cp

    def visit_ListComp(self, node: ListComp):
        assert len(node.generators) == 1, &#34;Currently only one generator supported&#34;
        gen = node.generators[0]
        assert isinstance(
            gen.target, Name
        ), &#34;Can only assign value to singleton element&#34;
        assert isinstance(gen.target, Name), &#34;Can only assign to singleton name&#34;
        node_cp = copy(node)
        node_cp.generators = [copy(gen)]
        self.enter_scope()
        self.set_guaranteed(gen.target.id)
        node_cp.generators[0].ifs = [self.visit(if_expr) for if_expr in gen.ifs]
        node_cp.elt = self.visit(node.elt)
        self.exit_scope()
        return node_cp

    def visit_Assign(self, node: Assign):
        for t in node.targets:
            assert isinstance(t, Name), f&#34;Need to have name, not {t.__class__}&#34;
            self.set_guaranteed(t.id)
        return self.generic_visit(node)

    def visit_AnnAssign(self, node: AnnAssign):
        assert isinstance(
            node.target, Name
        ), f&#34;Need to have name, not {node.target.__class__}&#34;
        self.set_guaranteed(node.target.id)
        return self.generic_visit(node)

    def visit_ClassDef(self, node: ClassDef):
        self.set_guaranteed(node.name)
        return node

    def visit_FunctionDef(self, node: FunctionDef):
        node_cp = copy(node)
        self.set_guaranteed(node.name)
        self.enter_scope()
        # variable names are available here
        for a in node.args.args:
            self.set_guaranteed(a.arg)
        node_cp.body = [self.visit(s) for s in node.body]
        self.exit_scope()
        return node_cp

    def visit_Name(self, node: Name):
        if isinstance(node.ctx, Load):
            assert self.guaranteed(
                node.id
            ), f&#34;Variable {node.id} is not initialized in (every branch of) preceding control flow&#34;
        return self.generic_visit(node)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="hebi.util.CompilingNodeTransformer" href="../util.html#hebi.util.CompilingNodeTransformer">CompilingNodeTransformer</a></li>
<li><a title="hebi.typed_ast.TypedNodeTransformer" href="../typed_ast.html#hebi.typed_ast.TypedNodeTransformer">TypedNodeTransformer</a></li>
<li>ast.NodeTransformer</li>
<li>ast.NodeVisitor</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.guaranteed_avail_names"><code class="name">var <span class="ident">guaranteed_avail_names</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.loaded_vars"><code class="name">var <span class="ident">loaded_vars</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.step"><code class="name">var <span class="ident">step</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.enter_scope"><code class="name flex">
<span>def <span class="ident">enter_scope</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def enter_scope(self):
    self.guaranteed_avail_names.append([])</code></pre>
</details>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.exit_scope"><code class="name flex">
<span>def <span class="ident">exit_scope</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def exit_scope(self):
    self.guaranteed_avail_names.pop()</code></pre>
</details>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.guaranteed"><code class="name flex">
<span>def <span class="ident">guaranteed</span></span>(<span>self, name: str) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def guaranteed(self, name: str) -&gt; bool:
    name = name
    for scope in reversed(self.guaranteed_avail_names):
        if name in scope:
            return True
    return False</code></pre>
</details>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.set_guaranteed"><code class="name flex">
<span>def <span class="ident">set_guaranteed</span></span>(<span>self, name: str)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_guaranteed(self, name: str):
    self.guaranteed_avail_names[-1].append(name)</code></pre>
</details>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit"><code class="name flex">
<span>def <span class="ident">visit</span></span>(<span>self, node)</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="hebi.util.CompilingNodeTransformer" href="../util.html#hebi.util.CompilingNodeTransformer">CompilingNodeTransformer</a></code>.<code><a title="hebi.util.CompilingNodeTransformer.visit" href="../util.html#hebi.util.CompilingNodeTransformer.visit">visit</a></code>
</p>
<div class="desc inherited"><p>Visit a node.</p></div>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_AnnAssign"><code class="name flex">
<span>def <span class="ident">visit_AnnAssign</span></span>(<span>self, node: _ast.AnnAssign)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_AnnAssign(self, node: AnnAssign):
    assert isinstance(
        node.target, Name
    ), f&#34;Need to have name, not {node.target.__class__}&#34;
    self.set_guaranteed(node.target.id)
    return self.generic_visit(node)</code></pre>
</details>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_Assign"><code class="name flex">
<span>def <span class="ident">visit_Assign</span></span>(<span>self, node: _ast.Assign)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_Assign(self, node: Assign):
    for t in node.targets:
        assert isinstance(t, Name), f&#34;Need to have name, not {t.__class__}&#34;
        self.set_guaranteed(t.id)
    return self.generic_visit(node)</code></pre>
</details>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_ClassDef"><code class="name flex">
<span>def <span class="ident">visit_ClassDef</span></span>(<span>self, node: _ast.ClassDef)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_ClassDef(self, node: ClassDef):
    self.set_guaranteed(node.name)
    return node</code></pre>
</details>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_For"><code class="name flex">
<span>def <span class="ident">visit_For</span></span>(<span>self, node: _ast.For)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_For(self, node: For):
    node_cp = copy(node)
    assert isinstance(node.target, Name), &#34;Can only assign to singleton name&#34;
    self.enter_scope()
    self.guaranteed(node.target.id)
    node_cp.body = [self.visit(s) for s in node.body]
    node_cp.orelse = [self.visit(s) for s in node.orelse]
    self.exit_scope()
    return node_cp</code></pre>
</details>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_FunctionDef"><code class="name flex">
<span>def <span class="ident">visit_FunctionDef</span></span>(<span>self, node: _ast.FunctionDef)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_FunctionDef(self, node: FunctionDef):
    node_cp = copy(node)
    self.set_guaranteed(node.name)
    self.enter_scope()
    # variable names are available here
    for a in node.args.args:
        self.set_guaranteed(a.arg)
    node_cp.body = [self.visit(s) for s in node.body]
    self.exit_scope()
    return node_cp</code></pre>
</details>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_If"><code class="name flex">
<span>def <span class="ident">visit_If</span></span>(<span>self, node: _ast.If)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_If(self, node: If):
    node_cp = copy(node)
    node_cp.test = self.visit(node.test)
    self.enter_scope()
    node_cp.body = [self.visit(s) for s in node.body]
    scope_body_cp = self.guaranteed_avail_names[-1].copy()
    self.exit_scope()
    self.enter_scope()
    node_cp.orelse = [self.visit(s) for s in node.orelse]
    scope_orelse_cp = self.guaranteed_avail_names[-1].copy()
    self.exit_scope()
    # what remains after this in the scope is the intersection of both
    for var in set(scope_body_cp).intersection(scope_orelse_cp):
        self.set_guaranteed(var)
    return node_cp</code></pre>
</details>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_ListComp"><code class="name flex">
<span>def <span class="ident">visit_ListComp</span></span>(<span>self, node: _ast.ListComp)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_ListComp(self, node: ListComp):
    assert len(node.generators) == 1, &#34;Currently only one generator supported&#34;
    gen = node.generators[0]
    assert isinstance(
        gen.target, Name
    ), &#34;Can only assign value to singleton element&#34;
    assert isinstance(gen.target, Name), &#34;Can only assign to singleton name&#34;
    node_cp = copy(node)
    node_cp.generators = [copy(gen)]
    self.enter_scope()
    self.set_guaranteed(gen.target.id)
    node_cp.generators[0].ifs = [self.visit(if_expr) for if_expr in gen.ifs]
    node_cp.elt = self.visit(node.elt)
    self.exit_scope()
    return node_cp</code></pre>
</details>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_Module"><code class="name flex">
<span>def <span class="ident">visit_Module</span></span>(<span>self, node: _ast.Module) ‑> _ast.Module</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_Module(self, node: Module) -&gt; Module:
    # repeat until no more change due to removal
    # i.e. b = a; c = b needs 2 passes to remove c and b
    node_cp = copy(node)
    self.enter_scope()
    node_cp.body = [self.visit(s) for s in node_cp.body]
    self.exit_scope()
    return node_cp</code></pre>
</details>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_Name"><code class="name flex">
<span>def <span class="ident">visit_Name</span></span>(<span>self, node: _ast.Name)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_Name(self, node: Name):
    if isinstance(node.ctx, Load):
        assert self.guaranteed(
            node.id
        ), f&#34;Variable {node.id} is not initialized in (every branch of) preceding control flow&#34;
    return self.generic_visit(node)</code></pre>
</details>
</dd>
<dt id="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_While"><code class="name flex">
<span>def <span class="ident">visit_While</span></span>(<span>self, node: _ast.While)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_While(self, node: While):
    node_cp = copy(node)
    node_cp.test = self.visit(node.test)
    self.enter_scope()
    node_cp.body = [self.visit(s) for s in node.body]
    node_cp.orelse = [self.visit(s) for s in node.orelse]
    self.exit_scope()
    return node_cp</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div style="max-width: 330px; margin-bottom: 10px">
<header>
<a class="homelink" rel="home" title="hebi Home" href="https://hebi.opshin.dev/">
<img src="https://raw.githubusercontent.com/OpShin/hebi/master/hebi.png" alt="hebi logo"> &nbsp; hebi
</a>
</header>
</div>
<form>
<input id="lunr-search" name="q" placeholder="🔎 Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../../doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="hebi.rewrite" href="index.html">hebi.rewrite</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables">RewriteGuaranteedVariables</a></code></h4>
<ul class="">
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.enter_scope" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.enter_scope">enter_scope</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.exit_scope" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.exit_scope">exit_scope</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.guaranteed" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.guaranteed">guaranteed</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.guaranteed_avail_names" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.guaranteed_avail_names">guaranteed_avail_names</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.loaded_vars" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.loaded_vars">loaded_vars</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.set_guaranteed" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.set_guaranteed">set_guaranteed</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.step" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.step">step</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit" href="../util.html#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit">visit</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_AnnAssign" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_AnnAssign">visit_AnnAssign</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_Assign" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_Assign">visit_Assign</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_ClassDef" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_ClassDef">visit_ClassDef</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_For" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_For">visit_For</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_FunctionDef" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_FunctionDef">visit_FunctionDef</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_If" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_If">visit_If</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_ListComp" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_ListComp">visit_ListComp</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_Module" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_Module">visit_Module</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_Name" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_Name">visit_Name</a></code></li>
<li><code><a title="hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_While" href="#hebi.rewrite.rewrite_guaranteed_variables.RewriteGuaranteedVariables.visit_While">visit_While</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>